<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>All Posts</title>
    <!-- Add any necessary styles or scripts -->
    <style>
      body {
        font-family: arial;
        margin: 0;
        background-color: #f4f4f4;
      }
      nav {
        background: #ff5353;
        padding: 20px 10px;
      }
      nav ul {
        max-width: 960px;
        margin: 0 auto;
        padding: 0;
      }
      nav li {
        list-style-type: none;
        display: inline-block;
        margin: 0 10px 0 0;
      }
      nav a {
        color: #fff;
        font-size: 18px;
        background: rgba(255, 255, 255, 0.2);
        text-decoration: none;
        padding: 10px;
        display: block;
      }
      main {
        max-width: 960px;
        margin: 30px auto;
        padding: 0 10px;
      }
      .post-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
      }
      .post-card h3 {
        color: #333;
      }
      .post-card p {
        color: #777;
      }
    </style>
  </head>
  <body>
    <h1>All Posts</h1>
    <main>
      <% posts.forEach(post => { %>
      <div class="post-card">
        <h3><%= user.displayName %></h3>
        <p><%= post.message %></p>
       

        <!-- Reply button and input -->
        <button class="reply-btn" onclick="toggleReplyInput('<%= post._id %>')">
          Reply
        </button>
        <div id="reply-input-<%= post._id %>" style="display: none">
          <input
            type="text"
            id="reply-text-<%= post._id %>"
            placeholder="Type your reply"
          />
          <button onclick="submitReply('<%= post._id %>', '<%= user._id %>')">Submit Reply</button>
          Submit Reply
          </button>
        </div>

        <!-- Display reply count -->
        <p>
          Replies:
          <span id="reply-count-<%= post._id %>">
            <%= post.replies ? post.replies.length : 0 %>
          </span>
        </p>
      </div>
      <% }); %>
    </main>

    <script>
      function toggleReplyInput(postId) {
        const replyInput = document.getElementById(`reply-input-${postId}`);
        replyInput.style.display =
          replyInput.style.display === 'none' ? 'block' : 'none';
      }

      async function submitReply(postId, userId) {
        try {
          const replyText = document.getElementById(
            `reply-text-${postId}`
          ).value;

          // Make the POST request to create a new reply
          const response = await fetch('http://localhost:8080/replies/create', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              message: replyText,
              googleUser: userId,
              postId,
            }),
          });

          console.log(response.status);
          console.log(response.statusText);

          if (!response.ok) {
            throw new Error(`Failed to create reply: ${response.status}`);
          }

          // Parse the response JSON
          const data = await response.json();

          // Assuming the server responds with the created reply object
          console.log('Reply created:', data);
        } catch (error) {
          console.error('Error creating reply:', error.message);
        }
      }
    </script>
  </body>
</html>
